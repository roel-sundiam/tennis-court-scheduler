<div class="players-container">
  <!-- Access Denied State -->
  <div *ngIf="!hasAccess" class="access-denied">
    <mat-card class="premium-card">
      <mat-card-header>
        <mat-icon class="premium-icon">people</mat-icon>
        <mat-card-title>Premium Feature</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <p>Access to Players Management requires {{ pageCost }} coin{{ pageCost > 1 ? 's' : '' }}.</p>
        <p *ngIf="!coinService.hasUnlimitedAccess()">
          Current balance: {{ coinBalance }} coin{{ coinBalance === 1 ? '' : 's' }}
        </p>
        <div class="access-actions">
          <button mat-raised-button 
                  color="accent" 
                  (click)="checkPageAccess()"
                  [disabled]="!coinService.canAfford('PLAYERS_VIEW')">
            <mat-icon>payment</mat-icon>
            Purchase Access ({{ pageCost }} ðŸª™)
          </button>
          <button mat-stroked-button 
                  (click)="openPurchaseModal()"
                  *ngIf="!coinService.canAfford('PLAYERS_VIEW')">
            <mat-icon>shopping_cart</mat-icon>
            Buy More Coins
          </button>
        </div>
      </mat-card-content>
    </mat-card>
  </div>

  <!-- Main Content (Accessible) -->
  <div *ngIf="hasAccess">
    <div class="header">
      <h1>Players Management</h1>
      <button *ngIf="auth.isAdmin()" 
              class="btn btn-primary" 
              routerLink="/players/new" 
              [disabled]="saving || !coinService.canAfford('PLAYER_ADD')"
              [title]="coinService.canAfford('PLAYER_ADD') ? 'Add new player (2 coins)' : 'Insufficient coins to add player'">
        <i class="fas fa-plus"></i> Add New Player
        <span class="coin-cost" *ngIf="!coinService.hasUnlimitedAccess()">
          (2 ðŸª™)
        </span>
      </button>
    </div>

  <div class="players-table-container">
    <div class="drag-instructions">
      <mat-icon>drag_indicator</mat-icon>
      <span>Use the drag handle to reorder players by seed ranking</span>
    </div>
    
    <div cdkDropList (cdkDropListDropped)="onDrop($event)" class="players-list" [cdkDropListDisabled]="saving">
      <div *ngFor="let player of players; trackBy: trackByPlayerId" 
           cdkDrag 
           class="player-row"
           [class.cdk-drag-preview]="false"
           [cdkDragDisabled]="saving">
        
        <div class="drag-handle" cdkDragHandle>
          <mat-icon>drag_indicator</mat-icon>
        </div>
        
        <div class="player-info">
          <div class="seed-cell">
            <span class="seed-badge">{{ player.seed }}</span>
          </div>
          <div class="name-cell">{{ player.name }}</div>
        </div>
        
        <div class="actions-cell" *ngIf="auth.isAdmin()">
          <button class="btn btn-sm btn-outline-primary" 
                  [routerLink]="['/players', player.id, 'edit']" 
                  [disabled]="saving || !coinService.canAfford('PLAYER_EDIT')"
                  [title]="coinService.canAfford('PLAYER_EDIT') ? 'Edit player (1 coin)' : 'Insufficient coins to edit player'">
            <i class="fas fa-edit"></i> <span class="btn-text">Edit</span>
            <span class="coin-cost" *ngIf="!coinService.hasUnlimitedAccess()">(1 ðŸª™)</span>
          </button>
          <button class="btn btn-sm btn-outline-danger" 
                  (click)="deletePlayer(player.id)" 
                  [disabled]="saving || !coinService.canAfford('PLAYER_DELETE')"
                  [title]="coinService.canAfford('PLAYER_DELETE') ? 'Delete player (1 coin)' : 'Insufficient coins to delete player'">
            <i class="fas fa-trash"></i> <span class="btn-text">Delete</span>
            <span class="coin-cost" *ngIf="!coinService.hasUnlimitedAccess()">(1 ðŸª™)</span>
          </button>
        </div>
      </div>
    </div>

    <div *ngIf="players.length === 0" class="no-players">
      <p>No players found. Add your first player to get started!</p>
    </div>
  </div>

    <div class="spinner-overlay" *ngIf="saving">
      <div class="spinner"></div>
      <div class="spinner-text">Saving...</div>
    </div>
  </div>
</div> 